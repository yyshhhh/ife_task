<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>color picker</title>
    <style type="text/css">

        #cont{background-color: #737373; padding: 10px; height: 300px; width:480px;}
        #cont #pickers{position: relative; display: inline-block; width:300px; height: 300px; }
        #cont #pickers #picker{width: 300px; height: 300px; background-color: #ff0000;}
        #cont #pickers #picker-indicator{position: absolute; left: 294px; top: -6px; border: 2px solid black; border-radius: 5px; width: 8px; height: 8px; background-color: white; opacity: 0.5;}
        #cont #sliders{position: relative; display: inline-block; margin-left: 20px;  width:30px; height: 300px;}
        #cont #sliders #slider-indicator{position: absolute; left: -4px; top: -7px; border: 2px solid black; border-radius: 2px; width: 34px; height: 10px; background-color: white; opacity: 0.5;}
        #cont #numbers{ display: inline-block; vertical-align: bottom; margin-left: 10px;  color: white; font-family: Microsoft Yahei;}
        #cont #numbers label{display: block; margin-bottom: 8px; height: 20px;}
        #cont #numbers label span{display: inline-block; width: 20px;}
        #cont #numbers label input{ width: 50px;}





    </style>


</head>
<body>

    <div id="cont">

    <div id="pickers">
        <div id="picker">
            <svg  xmlns="http://www.w3.org/2000/svg" width="300px" height="300px" version="1.1">
                <defs>
                    <linearGradient id="gradient-black" x1="0%" y1="100%" x2="0%" y2="0%">
                        <stop offset="0%" stop-color="#000000" stop-opacity="1"></stop>
                        <stop offset="100%" stop-color="#ffffff" stop-opacity="0"></stop>
                    </linearGradient>
                    <linearGradient id="gradient-white" x1="0%" y1="100%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#ffffff" stop-opacity="1"></stop>
                        <stop offset="100%" stop-color="#ffffff" stop-opacity="0"></stop>
                    </linearGradient>
                </defs>
                <rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-white)"></rect>
                <rect x="0" y="0" width="100%" height="100%" fill="url(#gradient-black)"></rect>
            </svg>
        </div>
        <div id="picker-indicator"></div>
    </div>

    <div id="sliders">
        <div id="slider">
            <svg xmlns="http://www.w3.org/2000/svg" width="30px" height="300px" version="1.1">
                <defs>
                    <linearGradient id="gradient-hsv" x1="0%" y1="100%" x2="0%" y2="0%">
                        <stop offset="0%" stop-color="#ff0000" stop-opacity="1"></stop>
                        <stop offset="8%" stop-color="#ff7f00" stop-opacity="1"></stop>
                        <stop offset="17%" stop-color="#ffff00" stop-opacity="1"></stop>
                        <stop offset="25%" stop-color="#80ff00" stop-opacity="1"></stop>
                        <stop offset="33%" stop-color="#00ff00" stop-opacity="1"></stop>
                        <stop offset="42%" stop-color="#00ff80" stop-opacity="1"></stop>
                        <stop offset="50%" stop-color="#00ffff" stop-opacity="1"></stop>
                        <stop offset="58%" stop-color="#0080ff" stop-opacity="1"></stop>
                        <stop offset="67%" stop-color="#0000ff" stop-opacity="1"></stop>
                        <stop offset="75%" stop-color="#8000ff" stop-opacity="1"></stop>
                        <stop offset="83%" stop-color="#ff00ff" stop-opacity="1"></stop>
                        <stop offset="92%" stop-color="#ff007f" stop-opacity="1"></stop>
                        <stop offset="100%" stop-color="#ff0000" stop-opacity="1"></stop>
                    </linearGradient>
                </defs>
                <rect width="30px" height="300px" fill="url(#gradient-hsv)"></rect>
            </svg>
        </div>
        <div id="slider-indicator"></div>
    </div>

    <div id="numbers">
        <label><span>H</span><input type="" name="" id="h"> 度</label>
        <label><span>S</span><input type="" name="" id="s"> %</label>
        <label><span>B</span><input type="" name="" id="v"> %</label>
        <label><span>R</span><input type="" name="" id="r"></label>
        <label><span>G</span><input type="" name="" id="g"></label>
        <label><span>B</span><input type="" name="" id="b"></label>
        <label><span>#</span><input type="" name="" id="hex"></label>
    </div>

    </div>

    <script type="text/javascript">
        var cont = document.getElementById('cont');



        function colorPicker(){

            var picker = document.getElementById('picker');
            var silder = document.getElementById('slider');
            var pickers = document.getElementById('pickers');
            var silders = document.getElementById('sliders');
            var sliderIndicator = document.getElementById('slider-indicator');
            var pickerIndicator = document.getElementById('picker-indicator');
            var color = {h: 56, s:1, v:1};


            hsv2rgb(color);
            showColor(color);


            //判断是svg还是vml还是svgAngle
            var type = window.SVGAngle || documentimplementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1") ? "SVG" : "VML",
                picker, slide, hueOffset = 15, svgNS = 'http://www.w3.org/2000/svg';
            var colorpickerHTMLSnippet = [

                '<div class="picker-wrapper">',
                        '<div class="picker"></div>',
                        '<div class="picker-indicator"></div>',
                '</div>',
                '<div class="slide-wrapper">',
                        '<div class="slide"></div>',
                        '<div class="slide-indicator"></div>',
                '</div>'

            ].join('');

            function mousePosition(evt) {
                // IE:
                if (window.event && window.event.contentOverflow !== undefined) {
                    return { x: window.event.offsetX, y: window.event.offsetY };
                }
                // Webkit:
                if (evt.offsetX !== undefined && evt.offsetY !== undefined) {
                    return { x: evt.offsetX, y: evt.offsetY };
                }
            }

            //从hsv得到rbg的值
            function hsv2rgb(color){
                var R,G,B,h,f,p,q,t,r,g,b,v;
                v = color.v;
                h = Math.floor(color.h / 60) % 6;
                f = color.h / 60 - h;
                p = color.v * (1 - color.s);
                q = color.v * (1- f * color.s);
                t = color.v * (1- (1 - f) * color.s);
                R = [v, q, p, p, t, v][h];
                G = [t, v, v, q, p, p][h];
                B = [p, p, t, v, v, q][h];
                r = Math.round( R * 255 );
                g = Math.round( G * 255 );
                b = Math.round( B * 255 );
                color.r = r;
                color.g = g;
                color.b = b;
                var r16, g16, b16;
                if (r > 15)
                    {r16 = r.toString(16);}
                else{
                    r16 = '0' + r.toString(16);
                }
                if (g > 15)
                    {g16 = g.toString(16);}
                else{
                    g16 = '0' + g.toString(16);
                }
                if (b > 15)
                    {b16 = b.toString(16);}
                else{
                    b16 = '0' + b.toString(16);
                }

                color.hex = r16 + g16 + b16;
            }

            //从rgb得到hsv的值
            function rgb2hsv(color){
                var r = color.r / 255,
                    b = color.b / 255,
                    g = color.g / 255;
                var h, s, v, H, S ,V;
                v = Math.max(r, g, b);
                min = Math.min(r, g, b);
                s =  v == 0 ? 0 : (v - min) / v;
                if ( v == r && g >= b ){
                    h = 60 * ( g - b ) / ( v - min);
                }
                else if ( v == r && g < b ){
                    h = 60 * ( g - b ) / ( v - min) + 360;
                }
                else if ( v == g ){
                    h = 60 * ( b - r ) / ( v - min) + 120;
                }
                else if ( v == b ){
                    h = 60 * ( r - g ) / ( v - min) + 240;
                }
                H = parseInt(h * 100);
                S = parseInt(s * 100);
                V = parseInt(v * 100);
                color.h = H;
                color.s = S;
                color.v = V;
                var r16, g16, b16;
                if (color.r > 15)
                    {r16 = color.r.toString(16);}
                else{
                    r16 = '0' + color.r.toString(16);
                }
                if (color.g > 15)
                    {g16 = color.g.toString(16);}
                else{
                    g16 = '0' + color.g.toString(16);
                }
                if (color.b > 15)
                    {b16 = color.b.toString(16);}
                else{
                    b16 = '0' + color.b.toString(16);
                }

                color.hex = r16 + g16 + b16;


            }

            //跨浏览器事件处理
            var EventUtil = {

                addHandler: function(element, type, handler){
                    if (element.addEventListener){
                        element.addEventListener(type, handler, false);
                    } else if (element.attachEvent){
                        element.attachEvent("on" + type, handler);
                    } else {
                        element["on" + type] = handler;
                    }
                },
                removeHandler: function(element, type, handler){
                    if (element.removeEventListener){
                        element.removeEventListener(type, handler, false);
                    } else if (element.detachEvent){
                        element.detachEvent("on" + type, handler);
                    } else {
                        element["on" + type] = null;
                    }
                }

            };

            //根据slide得到色相，并且反应到colorpicker上
            function sliderListener(color){
                return function(evt){
                    evt = evt || window.event;
                    var mouse = mousePosition(evt);
                    color.h = ( 1 - mouse.y / sliders.offsetHeight ) * 360;
                    hsv2rgb(color);
                    showColor(color);
                    var colorBac = color;
                    colorBac.s = 1;
                    colorBac.v = 1;
                    hsv2rgb(colorBac);
                    picker.style.backgroundColor = '#' + colorBac.hex;
                    sliderIndicator.top = mouse.y - 7 + 'px';
                };
            }

            //根据picker的鼠标位置取到颜色值
            function pickerListener(color){
                return function(evt){
                    evt = evt || window.event;
                    var mouse = mousePosition(evt),
                        width = pickers.offsetWidth,
                        height = pickers.offsetHeight;
                    color.s = mouse.x / width;
                    color.v = (height - mouse.y) / height;
                    hsv2rgb(color);
                    showColor(color);



                };
            }

            //显示颜色值
            function showColor(color){
                document.getElementById('h').value = parseInt(color.h);
                document.getElementById('s').value = parseInt(color.s * 100);
                document.getElementById('v').value = parseInt(color.v * 100);
                document.getElementById('r').value = color.r;
                document.getElementById('g').value = color.g;
                document.getElementById('b').value = color.b;
                document.getElementById('hex').value = color.hex;
            }

            //拖动鼠标的事件处理
            function dragging(color, element, listener){
                var mousedown = false;

                EventUtil.addHandler(element, 'mousedown', function(evt){
                    evt = evt || window.event;
                    mousedown = true; })
                EventUtil.addHandler(element, 'mouseup', function(evt){
                    evt = evt || window.event;
                    mousedown = false; })
                EventUtil.addHandler(element, 'mouseout', function(evt){
                    evt = evt || window.event;
                    mousedown = false; })
                EventUtil.addHandler(element, 'mousemove', function(evt){
                    evt = evt || window.event;
                    if (mousedown){
                        listener(evt);
                    }
                })
            }

            dragging(color, sliders, sliderListener(color));
            dragging(color, pickers, pickerListener(color));

        }

        colorPicker();


    </script>
</body>
</html>